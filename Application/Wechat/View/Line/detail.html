<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>{$line.xl_name}</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="__PUBLIC__/Home/css/sm.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/Home/css/sm-extend.min.css">
    <link rel="stylesheet" href="__PUBLIC__/Home/css/reset_app.css" />
    <link rel="stylesheet" href="__PUBLIC__/Home/iconfont/iconfont.css" />
    <style>
         .clearfix:after,
        .clearfix:before {
            display: table;
            content: " ";
        }
        
        .clearfix:after {
            clear: both;
        }
        
        .wpad10 {
            background-color: #fff;
            padding: .5rem;
        }
        
        .wmargin10 {
            margin: 0 .5rem;
            background-color: #fff;
        }
        
        .wpad10 .wtitle {
            font-size: .8rem;
            font-weight: 300;
        }
        
        .center {
            width: 100%;
            position: relative;
        }
        
        .center .location1 {
            font-size: .7rem;
            color: #898989;
        }
        
        .center .price {
            font-size: 1rem;
            color: #FF2E3D;
        }
        
        .center .tag {
            margin-right: 5px;
            border: 1px solid #aaa;
            padding: .1rem;
            font-size: .6rem;
            color: #aaa;
            border-radius: 3px;
        }
        
        /*.center .price>span {
            font-size: .6rem;
        }*/
        
        .wcontent {
            font-size: .6rem;
            background-color: #F0F0F0;
        }
        
        .wcomment {
            margin-top: .6rem;
            background-color: #fff;
            line-height: 2rem;
        }
        
        .wcomment .number {
            color: #FFA61F;
        }
        
        .wcomment .frnumber {
            float: right;
            font-size: .7rem;
            margin-right: .6rem;
            color: #999;
        }
        
        .wcomment .flnumber {
            float: left;
            font-size: .8rem;
        }
        
        .wcomment .border-r {
            display: inline-block;
            height: .7rem;
            width: .2rem;
            margin-top: .2rem;
            margin-right: .2rem;
            background-color: #41A4F0;
        }
        
        .tc-content {
            padding-top: .4rem;
        }
        
        .tc-content div {
            font-size: .7rem;
            line-height: 1.5;
        }
        
        .threelie div {
            font-size: .7rem;
            color: #666;
        }
        
        .wfixed {
            line-height: 2.5rem;
            padding-left: 1rem;
            position: fixed;
            background-color: #fff;
            bottom: 0;
            left: 0;
            right: 0;
        }
        
        .wfixed .rb-btn {
            float: right;
            border: none;
            padding: 0 .5rem;
            background-color: #F37B1D;
            color: #fff;
        }
        
        .ipt-date,
        .ipt-num {
            background-color: #fff;
            line-height: 1.5;
            padding: .6rem
        }
        
        .ipt-date label,
        .ipt-num label {
            font-size: .7rem;
        }
        
        .ipt-date input,
        .ipt-num input {
            width: 50%;
        }
        
        .wsmall {
            margin: 0;
            padding: 0 .6rem;
            font-size: .7rem;
            color: #666;
            line-height: 1.5;
        }
        
        .tc-content .datetag {
            border: 1px solid #aaa;
            padding: .1rem .2rem;
            font-size: .6rem;
            color: #333;
            border-radius: 3px;
        }
        
        .tc-content .datetag.more {
            color: #0DA4E0;
        }
        
        .pag {
            padding: 0 .6rem;
            line-height: 1.5;
            margin-top: .5rem;
            font-size: .6rem;
        }
        
        .bgtitle {
            font-weight: 900;
            font-size: 1rem;
            padding-left: .6rem;
        }
        
        .bgtitle span {
            font-size: .7rem;
            font-weight: 300;
        }
        
        .canyin img {
            margin-right: .4rem;
            margin-top: -.2rem;
        }
        
        .canyin {
            font-size: .7rem;
            font-weight: 900;
            line-height: 2;
        }
        
        .canyinl {
            font-size: .6rem;
            font-weight: 300;
            margin-left: .6rem;
            line-height: 1;
        }

        #setList{display:none;}
            .setList{padding:0 10px;font-size:.6rem;}
            .setList ul{}
            .setList ul li{display:none;}
            .setList ul li label{display:block;}
    </style>
</head>

<body>
    <script type='text/javascript' src='__PUBLIC__/Home/js/zepto.min.js' charset='utf-8'></script>
    <script type='text/javascript' src='__PUBLIC__/Home/js/sm.min.js' charset='utf-8'></script>
    <script type='text/javascript' src='__PUBLIC__/Home/js/sm-extend.min.js' charset='utf-8'></script>
    <div class="page">
        <div class="content" style="width:100%">
            <img src="{$line.xl_list_img}" alt="" width="100%" height="206">
            <div class="wpad10">
                <h3 class="wtitle">{$line.xl_name}</h3>
                <div class="center clearfix">
                    <div class="location1">{$line.xl_fb_detail}</div>
                    <div class="price"><span class="s_price">{$line.xl_qijia}</span><span>{$line.xl_qijia_dw}</span></div>
                    <volist name='biaoqin' id='vo'>
                        <span class="tag">{$vo}</span>
                    </volist>
                </div>
            </div>
            <div class="wcomment clearfix">
                <div class="flnumber">
                    <span class="border-r"></span>&nbsp;线路特色
                </div>
                <div style="clear:both"></div>
                <div class="wmargin10" style="border-top:1px solid #F0F0F0"></div>
                <div class="pag">
                    {$line.xl_tese}
                </div>
            </div>
            <div class="wcomment clearfix">
                <div class="flnumber">
                    <span class="border-r"></span>&nbsp;行程安排
                </div>
                <div style="clear:both"></div>
                <volist name='line.xl_xc' id='vo2'>
                    <div class="wmargin10" style="border-top:1px solid #F0F0F0"></div>
                    <div class="bgtitle">D{$vo2.xl_ts} <span>{$vo2.xl_xcbt}</span></div>
                    <div class="pag">
                        {$vo2.xl_xcsm}
                    </div>
                    <notempty name='vo2.xl_xct'><img src="{$vo2.xl_xct}" alt="" style="padding:0 .6rem;width:100%"></notempty>
                    <div style="padding-left:.5rem" class="canyin">
                        <img src="__PUBLIC__/Home/images/rc_cy_icon.png" alt="" style="width:.7rem">餐饮
                    </div>
                    <div style="padding-left:1rem" class="canyinl"><notempty name='vo2.xl_cy'>{$vo2.xl_cy}<else/>无</notempty> </div>
                    <div style="padding-left:.5rem" class="canyin">
                        <img src="__PUBLIC__/Home/images/rc_zs_icon.png" alt="" style="width:.7rem">住宿
                    </div>
                    <div style="padding-left:1rem" class="canyinl"><notempty name='vo2.xl_zs'>{$vo2.xl_zs}<else/>无</notempty> </div>
                    <div style="padding-left:.5rem" class="canyin">
                        <img src="__PUBLIC__/Home/images/rc_jt_icon.png" alt="" style="width:.7rem">交通
                    </div>
                    <div style="padding-left:1rem" class="canyinl"><notempty name='vo2.xl_ckhb'>{$vo2.xl_ckhb}<else/>无</notempty></div>
                    <div style="height:1rem"></div>
                </volist>
            </div>
            <div class="wcomment clearfix">
                <div class="flnumber">
                    <span class="border-r"></span>&nbsp;消费透明
                </div>
                <div style="clear:both"></div>
                <div class="wmargin10" style="border-top:1px solid #F0F0F0">
                </div>
                <div class="allxz">
                    <div class="wmargin10">费用包含</div>
                    <div class="wsmall">{$line.xl_bh}</div>
                </div>
                <div class="allxz">
                    <div class="wmargin10">费用不含</div>
                    <div class="wsmall">{$line.xl_bbh}</div>
                </div>

            </div>
            <if condition="$line['xl_ydts'] OR $line['xl_tkzc']">
            <div class="wcomment clearfix">
                <div class="flnumber">
                    <span class="border-r"></span>&nbsp;预定须知
                </div>
                <div style="clear:both"></div>
                <div class="wmargin10" style="border-top:1px solid #F0F0F0">
                </div>
                <div class="allxz">
                    <div class="wmargin10">旅游线路预订须知</div>
                    <div class="wsmall"><notempty name='line.xl_ydts'>{$line.xl_ydts}<else/>无</notempty></div>
                </div>
                <div class="allxz">
                    <div class="wmargin10">旅游线路退改政策</div>
                    <div class="wsmall"><notempty name='line.xl_tkzc'>{$line.xl_tkzc}<else/>无</notempty></div>
                </div>
            </div>
            </if>
            <div class="wcomment clearfix">
                <div class="flnumber">
                    <span class="border-r"></span>&nbsp;填写信息
                </div>
                <div style="clear:both"></div>
                <div class="wmargin10" style="border-top:1px solid #F0F0F0">
                </div>
                <div class="ipt-date">
                    <label for="">选择日期：</label>
                    <input type="text" data-toggle='date' id="my-input" placeholder="请选择日期"/>
                </div>
                <div class="ipt-num">
                    <label for="">成人人数：</label>
                    <input type="tel" id="adultnum"/>人
                </div>
                <div class="ipt-num">
                    <label for="">儿童人数：</label>
                    <input type="tel" id="childnum"/>人
                </div>
                <input type="hidden" id="priceid"/>
            </div>
    
            <div class="wcomment clearfix" id="setList">
                <div class="flnumber">
                    <span class="border-r"></span>&nbsp;套餐选择
                </div>
                <div style="clear:both"></div>
                <div class="tc_box setList">
                    <ul>
                    <volist name='lineinfo' id='vo' key="k">
                        <li data-week="{$vo[4]}" data-startdate="{$vo[2]}" data-enddata="{$vo[3]}" data-pid="{$vo[1]}">
                            <label>
                                <input type="radio" name="pid" value="{$vo[1]}" data-price="{$vo[5]}" /> 
                                <span>{$vo[6]}</span>
                                <span>{$vo[5]} 元/人</span>
                            </label>
                        </li>
                    </volist>
                    </ul>
                </div>
            </div>

            <div style="height:4rem;"></div>
        </div>
        <div class="wfixed">
            <button class="rb-btn" type="button" id="ydsubmit">立即预定</button>
        </div>

    </div>
    <script>
        $(function(){
            var mydate = new Date();
            var year=mydate.getFullYear();
            var month=mydate.getMonth();
            month+=1;
            if(month < 10){
                month = '0'+month;
            }
            var day=mydate.getDate();
            if(day < 10){
                day = '0'+day;
            }

            var minDate = year + "-" + month + "-" +day;
            var maxDate = "";

            var setList = $(".setList li")

            setList.each(function(){
                var temp = new Date($(this).data("enddata"));
                if(maxDate == ""){
                    maxDate = $(this).data("enddata");
                }else{
                    if(temp > new Date(maxDate)){
                        maxDate = $(this).data("enddata");
                    }
                }
            })

            $("#my-input").calendar({
                inputReadOnly: true,
                minDate: minDate,
                maxDate: maxDate,
                value: [],
                onChange: function(p, values, displayValues){
                    $("#setList").show();
                    setList.hide();
                    setList.find("input[type='radio']").prop("checked", false);
                    var count = 0;
                    setList.each(function(){
                        var s = new Date($(this).data("startdate"));
                        var e = new Date($(this).data("enddata"));
                        var w = $(this).data("week");
                        w = w.toString();

                        var chooseWeek = new Date(displayValues).getDay();
                        chooseWeek = chooseWeek.toString();
                        if(values >= s && values <= e && w.indexOf(chooseWeek) >= 0){
                            $(this).show().addClass("ct_show");
                            count++;
                        }
                    })
                    if(count == 1){
                        $(".ct_show").find("input").prop("checked", true);
                    }
                }
            });
        })
        
        $('#ydsubmit').on('click',function(){
            if(!$('#my-input').val() || !$('#adultnum').val()){
                $('#adultnum').focus();
            }else{
            	if(!$('#my-input').val()){
					alert('请选择规定的出行日期');
					return false;
				}
                if($('#adultnum').val()<=0){
                    alert('请填写成人人数');
                    return false;
                }
                if($('#childnum').val()<0){
                    alert('请填写儿童人数');
                    return false;
                }
                var dateinput = $('#my-input').val();
                if(!$('#childnum').val()){
                    $('#childnum').val(0);
                }
                var price = $("[name='pid']:checked").data("price");
                var priceid = $("[name='pid']:checked").val();
                var num = parseInt($('#adultnum').val())+parseInt($('#childnum').val());
                location.href = "{:u('Line/order')}?xlid="+{$lineid}+"&cfdate="+dateinput+"&adult="+$('#adultnum').val()+"&priceid="+priceid+"&child="+$('#childnum').val()+"&num="+num+"&price="+price;
            }
        });
        
    </script>
</body>

</html>