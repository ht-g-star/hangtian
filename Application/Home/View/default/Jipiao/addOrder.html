<extend name="Base/common"/>
    <link rel="stylesheet" href="/Public/hangtian/css/amazeui.min.css" />
<block name="style">
    <title>机票预定</title>
    <link rel="stylesheet" href="/Public/hangtian/plugin/dtp1/jquery.datetimepicker.css" />
    <link rel="stylesheet" href="/Public/hangtian/css/style.css" />
    <!--[if lt IE 9]>
    <link rel="stylesheet" href="/Public/hangtian/css/style1-IE.css" />
    <script type="text/javascript" src="/Public/hangtian/js/jquery-1.11.0.js" ></script>
    <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <script type="text/javascript" src="/Public/hangtian/js/amazeui.ie8polyfill.min.js" ></script>
    <![endif]-->
</block>
<block name="body">
<style>
	option{
		font-size: 18px;
	}
</style>
<!--面包屑导航-->
<div class="am-g am-g-fixed am-g-collapse">
    <div class="am-breadcrumb am-breadcrumb-slash">
        <li><a href="#">首页</a></li>
        <li><a href="#">健康商城</a></li>
        <li class="am-active"><a href="#">机票预定</a></li>
    </div>
</div>
<!--section-->
<div class="my_main">
    <div class="am-g am-g-fixed am-g-collapse order_gp">
    	<input type="hidden" id="userid" value="{$uid}" />
        <!--航班信息-->
        <div class="hb_info_gp ad_box_group">
            <h1>航班信息</h1>
            <div class="am-u-lg-12  clear">
                <p class="am-u-lg-6 am-text-center">去:{$_SESSION['hblist'][0]['fromCityCN']}→{$_SESSION['hblist'][0]['toCityCN']}</p>
                <p class="am-u-lg-6 am-text-center">{:date('Y-m-d', strtotime($_SESSION['hblist'][0]['fromDate']))}</p>
            </div>
            <div class="am-u-lg-12  clear">
                <p class="am-u-lg-4 am-text-center">{$_SESSION['hblist'][0]['flightObject'][I('o')]['flightNo']}</p>
                <p class="am-u-lg-4 am-text-sm am-text-center"><!--空客319(中)--></p>
                <p class="am-u-lg-4 am-text-center">{$_SESSION['hblist'][0]['flightObject'][I('o')]['cabinInfo'][I('v')]['cabinRankDetail']}</p>
            </div>
            <div class="am-u-lg-12  clear">
                <div class="am-u-lg-4 am-text-center">
                    <p class="starttime">{:date('H:i', strtotime($_SESSION['hblist'][0]['flightObject'][I('o')]['fromDate']))}</p>
                    <p class="startqy">
                    	{:setAirport($_SESSION['hblist'][0]['flightObject'][I('o')]['fromAirport']);}
                	</p>
                </div>
                <div class="am-u-lg-4 am-text-center">
                    <p class="tk_sc">时长：{$_SESSION['hblist'][0]['flightObject'][I('o')]['flightDuration']}</p>
                    <img src="/Public/hangtian/img/tc_sc.png" style="margin-top: -50px;width: 90%;" />
                </div>
                <div class="am-u-lg-4 am-text-center">
                    <p class="starttime">{:date('H:i', strtotime($_SESSION['hblist'][0]['flightObject'][I('o')]['toDate']))}</p>
                    <p class="startqy">
                    	{:setAirport($_SESSION['hblist'][0]['flightObject'][I('o')]['toAirport']);}
                    </p>
                </div>
            </div>
            <if condition="count($_SESSION['hblist']) eq 2">
            <div class="am-u-lg-12  clear">
                <p class="am-u-lg-6 am-text-center">回:{$_SESSION['hblist'][1]['fromCityCN']}→{$_SESSION['hblist'][1]['toCityCN']}</p>
                <p class="am-u-lg-6 am-text-center">{:date('Y-m-d', strtotime($_SESSION['hblist'][1]['fromDate']))}</p>
            </div>
            <div class="am-u-lg-12  clear">
                <p class="am-u-lg-4 am-text-center">{$_SESSION['hblist'][1]['flightObject'][I('o1')]['flightNo']}</p>
                <p class="am-u-lg-4 am-text-sm am-text-center"><!--空客319(中)--></p>
                <p class="am-u-lg-4 am-text-center">{$_SESSION['hblist'][1]['flightObject'][I('o1')]['cabinInfo'][I('f')]['cabinRankDetail']}</p>
            </div>
            <div class="am-u-lg-12  clear">
                <div class="am-u-lg-4 am-text-center">
                    <p class="starttime">{:date('H:i', strtotime($_SESSION['hblist'][1]['flightObject'][I('o1')]['fromDate']))}</p>
                    <p class="startqy">
                    	{:setAirport($_SESSION['hblist'][1]['flightObject'][I('o1')]['fromAirport'])}
                	</p>
                </div>
                <div class="am-u-lg-4 am-text-center">
                    <p class="tk_sc">时长：{$_SESSION['hblist'][1]['flightObject'][I('o1')]['flightDuration']}</p>
                    <img src="/Public/hangtian/img/tc_sc.png" style="margin-top: -50px;width: 90%;" />
                </div>
                <div class="am-u-lg-4 am-text-center">
                    <p class="starttime">{:date('H:i', strtotime($_SESSION['hblist'][1]['flightObject'][I('o1')]['toDate']))}</p>
                    <p class="startqy">
                    	{:setAirport($_SESSION['hblist'][1]['flightObject'][I('o1')]['toAirport']);}
                    </p>
                </div>
            </div>
            </if>
            <div class="am-u-lg-12  clear hb_js_box">
                <p class="am-u-lg-12">结算信息</p>
                <div class="am-u-lg-12">
                    <label class="am-u-lg-6 am-text-left">成人票</label>
                    <label class="am-u-lg-6 am-text-right">￥<span>{$_SESSION['hblist'][0]['flightObject'][I('o')]['cabinInfo'][I('v')]['facePrice']
						+ $_SESSION['hblist'][0]['flightObject'][I('o')]['airportFee']
						+ $_SESSION['hblist'][0]['flightObject'][I('o')]['fuelTax']
						+ $_SESSION['hblist'][1]['flightObject'][I('o1')]['cabinInfo'][I('f')]['facePrice']
						+ $_SESSION['hblist'][1]['flightObject'][I('o1')]['airportFee']
						+ $_SESSION['hblist'][1]['flightObject'][I('o1')]['fuelTax']}</span><!--X<span>1</span>--></label>
                </div>
                <div class="am-u-lg-12">
                    <label class="am-u-lg-6 am-text-left">服务费</label>
                    <label class="am-u-lg-6 am-text-right">￥<span>{:(
                    	$_SESSION['hblist'][0]['flightObject'][I('o')]['cabinInfo'][I('v')]['facePrice']
						+ $_SESSION['hblist'][0]['flightObject'][I('o')]['airportFee']
						+ $_SESSION['hblist'][0]['flightObject'][I('o')]['fuelTax']
						+ $_SESSION['hblist'][1]['flightObject'][I('o1')]['cabinInfo'][I('f')]['facePrice']
						+ $_SESSION['hblist'][1]['flightObject'][I('o1')]['airportFee']
						+ $_SESSION['hblist'][1]['flightObject'][I('o1')]['fuelTax']
                    )*0.03}</span><!--X<span>2</span>--></label>
                </div>
                <!--<div class="am-u-lg-12">
                    <label class="am-u-lg-6 am-text-left">成人机建费</label>
                    <label class="am-u-lg-6 am-text-right">￥<span>{$_SESSION['hblist'][0]['flightObject'][I('o')]['airportFee']+$_SESSION['hblist'][1]['flightObject'][I('o')]['airportFee']}</span></label>
                </div>-->
                <!--<div class="am-u-lg-12">
                    <label class="am-u-lg-6 am-text-left">儿童票</label>
                    <label class="am-u-lg-6 am-text-right">￥<span>590</span>X<span>2</span></label>
                </div>
                <div class="am-u-lg-12">
                    <label class="am-u-lg-6 am-text-left">税费</label>
                    <label class="am-u-lg-6 am-text-right">￥<span>590</span>X<span>2</span></label>
                </div>-->
                <div class="am-u-lg-12">
                    <label class="am-u-lg-6 am-text-left">保险费用</label>
                    <label class="am-u-lg-6 am-text-right">￥<span>
                    <if condition="$_GET['o1'] neq 'undefined'">
                    	{$bxdata[0]['normalPrice'] + $bxdata[0]['normalPrice']}
                	<else />
                		{$bxdata[0]['normalPrice']}
                    </if>
					</span></label>
                </div>
                <div class="am-u-lg-12 order_sm_ps">
                    <label class="am-u-lg-6 am-text-left">订单总金额</label>
                    <label class="am-u-lg-6 am-text-right tk_price">￥<span>{$sumprice}</span></label>
                </div>
                <div class="am-u-lg-12 am-text-center" style="padding-bottom:10px;">
            		<button type="button" class="am-btn am-btn-primary am-btn-sm" onclick="$('#rule').modal();">查看退改政策</button>
                </div>
            </div>
        </div>
        <!--联系人信息-->
        <form name=""  action="" method="post" id="formact">
        <div class="am-u-lg-8 ad_box_group">
            <h1>联系人信息</h1>
            <div class="cjr_gp">
				<empty name="address">
					<div id="senderdetail"></div>
					<div id="formsender" style="position:relative;">
						<div class="am-u-lg-12">
		                    <label class="am-u-lg-4">联系人：</label>
		                    <div class="am-u-lg-8"><input class="ipt_text" type="text" id="realname" placeholder="请输入姓名" /></div>
		                </div>
		                <div class="am-u-lg-12">
		                    <label class="am-u-lg-4">手机号码：</label>
		                    <div class="am-u-lg-8"><input class="ipt_text tel_num" id="phone" type="text" placeholder="请输手机号码" /></div>
		                </div>
						<div class="am-u-sm-10 am-margin-bottom-xs">
							<a href="javascript:void(0)" class="ncart_btn_on am-btn am-btn-primary" onclick="savemsg();" style="margin-left: 10px;">保存</a>
						</div>
						<div class="am-cf"></div>
					</div>
					<else/>
					<div id="hasaddress1" style="padding-left: 10px;">
						<div id="senderdetail">
							<p id="f_default">
								<volist name="address" id="a" >
									<input type="radio" <eq name="a.id" value="$default_id" >id="default" checked='checked'</eq> name="sender1" value="{$a.id}"/>&nbsp;联系人：{$a.realname}&nbsp;&nbsp;联系电话:{$a.cellphone}<br/>
								</volist>
							</p>
						</div>
						<a href="javascript:void(0);" id="addaddress">新增联系人</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						<a href="javascript:void(0);" id="setaddress">修改</a>
					</div>
					<div id="formsender" style="position:relative;display: none;">
						<div class="am-u-lg-12">
		                    <label class="am-u-lg-4">联系人：</label>
		                    <div class="am-u-lg-8"><input class="ipt_text" type="text" id="realname" placeholder="请输入姓名" /></div>
		                </div>
		                <div class="am-u-lg-12">
		                    <label class="am-u-lg-4">手机号码：</label>
		                    <div class="am-u-lg-8"><input class="ipt_text tel_num" id="phone" type="text" placeholder="请输手机号码" /></div>
		                </div>
						<div class="am-u-sm-10 am-margin-bottom-xs">
							<a href="javascript:void(0)" class="ncart_btn_on am-btn am-btn-primary" onclick="savemsg1();" style="margin-left: 10px;">保存</a>
						</div>
						<div class="am-cf"></div>
					</div>
					<div id="formsender1" style="position:relative;display: none;">
						<input type="hidden" value="" id='addidid'>
						<div class="am-u-lg-12">
		                    <label class="am-u-lg-4">联系人：</label>
		                    <div class="am-u-lg-8"><input class="ipt_text" type="text" id="realname1" placeholder="请输入姓名" /></div>
		                </div>
		                <div class="am-u-lg-12">
		                    <label class="am-u-lg-4">手机号码：</label>
		                    <div class="am-u-lg-8"><input class="ipt_text tel_num" id="phone1" type="text" placeholder="请输手机号码" /></div>
		                </div>
						<div class="am-u-sm-10 am-margin-bottom-xs">
							<a href="javascript:void(0)" style="margin-left: 10px;" class="ncart_btn_on am-btn am-btn-primary" onclick="save();">保存</a>
							<a href="javascript:void(0)" class="ncart_btn_on am-btn am-btn-primary" onclick="quxiao();">取消</a>
						</div>
						<div class="am-cf"></div>
					</div>
				</empty>
            </div>
        </div>
        <!--乘机人-->
        <div class="am-u-lg-8 ad_box_group">
            <h1>乘机人信息</h1>
            <input type="hidden" id="addidd" value="{:I('addid')}" />
            <div class="cjr_gp" id="ck_list">

                <!--乘客start-->
                <empty name="cjr">
	                <div class="ck_list clear" id="formcjr">
	                    <!--<span class="del_ck">删除该乘客</span>-->
	                    <div class="am-u-lg-12">
	                        <label class="am-u-lg-4">乘客姓名：</label>
	                        <div class="am-u-lg-8"><input class="ipt_text" type="text" id="ckname" name="chengke" placeholder="请输入姓名" /></div>
	                    </div>
	                    <div class="am-u-lg-12">
	                        <label class="am-u-lg-4">乘客手机号：</label>
	                        <div class="am-u-lg-8"><input class="ipt_text" type="text" id="ckmobile" name="phone" placeholder="请输入手机号" /></div>
	                    </div>
	                    <!--<div class="am-u-lg-12">
	                        <label class="am-u-lg-4">乘客出生日期：</label>
	                        <div class="am-u-lg-8"><input class="ipt_text" type="text" id="ckbirthday" name="shengri" placeholder="选择生日"  /></div>
	                    </div>-->
	                    <div class="am-u-lg-12">
	                        <label class="am-u-lg-4">乘客类型：</label>
	                        <div class="am-u-lg-8" id="wrap">
	                            <input name="fm2" type="radio" checked="checked" value="ADU" /><span>成人</span>
	                            <input name="fm2" type="radio" value="CHD" /><span>儿童</span>
	                        </div>
	                    </div>
	                    <div class="am-u-lg-12 clear">
	                        <label class="am-u-lg-4">证件类型：</label>
	                        <div class="am-u-lg-8">
	                            <select class="ch_zj">
	                                <!--<option>请选择</option>-->
	                                <option>二代身份证</option>
	                                <!--<option>护照</option>
	                                <option>军官证</option>
	                                <option>港澳通行证</option>
	                                <option>台胞证</option>-->
	                            </select>
	                            <input class="ipt_text" id="ckid" type="text" name="shenfenzheng" placeholder="证件号码" />
	                        </div>
	                    </div>
	                    <div class="am-u-sm-10 am-margin-bottom-xs">
							<a href="javascript:void(0)" class="ncart_btn_on am-btn am-btn-primary" onclick="savecjr();">保存</a>
						</div>
	                </div>
	                <else/>
	                <div id="hasaddress">
						<div id="senderdetail">
							<p id="f_default">
								<volist name="cjr" id="a" >
									<input type="checkbox" name="sender[]" class="choosecjr" data-cjrid="{$a.cjrid}" value="{$a.id}"/>&nbsp;乘机人：{$a.cjrname}&nbsp;&nbsp;乘机人电话:{$a.cjrmobile}&nbsp;&nbsp;身份证号:{$a.cjrid}<br/>
								</volist>
							</p>
						</div>
						<a href="javascript:void(0);" id="addcjr">新增乘机人</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						<a href="javascript:void(0);" id="setcjr">修改</a>
					</div>
					<div class="ck_list clear"  id="formcjr" style="position:relative;display: none;">
	                    <!--<span class="del_ck">删除该乘客</span>-->
	                    <div class="am-u-lg-12">
	                        <label class="am-u-lg-4">乘客姓名：</label>
	                        <div class="am-u-lg-8"><input class="ipt_text" type="text" id="ckname" name="chengke" placeholder="请输入姓名" /></div>
	                    </div>
	                    <div class="am-u-lg-12">
	                        <label class="am-u-lg-4">乘客手机号：</label>
	                        <div class="am-u-lg-8"><input class="ipt_text" type="text" id="ckmobile" name="phone" placeholder="请输入手机号" /></div>
	                    </div>
	                    <!--<div class="am-u-lg-12">
	                        <label class="am-u-lg-4">乘客出生日期：</label>
	                        <div class="am-u-lg-8"><input class="ipt_text" type="text" id="ckbirthday" name="shengri" placeholder="选择生日"  /></div>
	                    </div>-->
	                    <div class="am-u-lg-12">
	                        <label class="am-u-lg-4">乘客类型：</label>
	                        <div class="am-u-lg-8" id="wrap">
	                            <input name="fm2" type="radio" checked="checked" value="ADU" /><span>成人</span>
	                            <input name="fm2" type="radio" value="CHD" /><span>儿童</span>
	                        </div>
	                    </div>
	                    <div class="am-u-lg-12 clear">
	                        <label class="am-u-lg-4">证件类型：</label>
	                        <div class="am-u-lg-8">
	                            <select class="ch_zj">
	                                <!--<option>请选择</option>-->
	                                <option>二代身份证</option>
	                                <!--<option>护照</option>
	                                <option>军官证</option>
	                                <option>港澳通行证</option>
	                                <option>台胞证</option>-->
	                            </select>
	                            <input class="ipt_text" id="ckid" type="text" name="shenfenzheng" placeholder="证件号码" />
	                        </div>
	                    </div>
	                    <div class="am-u-sm-10 am-margin-bottom-xs">
							<a href="javascript:void(0)" class="ncart_btn_on am-btn am-btn-primary" onclick="savecjr1();">保存</a>
							<a href="javascript:void(0)" class="ncart_btn_on am-btn am-btn-primary" onclick="qxcjr1();">取消</a>
						</div>
	                </div>
	                <div class="ck_list clear"  id="formcjr1" style="position:relative;display: none;">
	                    <!--<span class="del_ck">删除该乘客</span>-->
	                    <input type="hidden" value="" id='addid'>
	                    <div class="am-u-lg-12">
	                        <label class="am-u-lg-4">乘客姓名：</label>
	                        <div class="am-u-lg-8"><input class="ipt_text" type="text" id="ckname1" name="chengke" placeholder="请输入姓名" /></div>
	                    </div>
	                    <div class="am-u-lg-12">
	                        <label class="am-u-lg-4">乘客手机号：</label>
	                        <div class="am-u-lg-8"><input class="ipt_text" type="text" id="ckmobile1" name="phone" placeholder="请输入手机号" /></div>
	                    </div>
	                    <!--<div class="am-u-lg-12">
	                        <label class="am-u-lg-4">乘客出生日期：</label>
	                        <div class="am-u-lg-8"><input class="ipt_text" type="text" id="ckbirthday1" name="shengri" placeholder="选择生日"  /></div>
	                    </div>-->
	                    <div class="am-u-lg-12">
	                        <label class="am-u-lg-4">乘客类型：</label>
	                        <div class="am-u-lg-8" id="wrap">
	                            <input name="fm1" type="radio" checked="checked" value="ADU" /><span>成人</span>
	                            <input name="fm1" type="radio" value="CHD" /><span>儿童</span>
	                        </div>
	                    </div>
	                    <div class="am-u-lg-12 clear">
	                        <label class="am-u-lg-4">证件类型：</label>
	                        <div class="am-u-lg-8">
	                            <select class="ch_zj">
	                                <!--<option>请选择</option>-->
	                                <option>二代身份证</option>
	                                <!--<option>护照</option>
	                                <option>军官证</option>
	                                <option>港澳通行证</option>
	                                <option>台胞证</option>-->
	                            </select>
	                            <input class="ipt_text" id="ckid1" type="text" name="shenfenzheng" placeholder="证件号码" />
	                        </div>
	                    </div>
	                    <div class="am-u-sm-10 am-margin-bottom-xs">
							<a href="javascript:void(0)" class="ncart_btn_on am-btn am-btn-primary" onclick="savecjr2();">保存</a>
							<a href="javascript:void(0)" class="ncart_btn_on am-btn am-btn-primary" onclick="qxcjr();">取消</a>
						</div>
	                </div>
	            </empty>
                <!--乘客end-->

            </div>
        </div>

       	<!-- 投保人 -->
       	<div class="am-u-lg-8 ad_box_group" id="tbrxx" style="display:none;">
       		<h1>提醒</h1>
       		<div class="ck_list clear">
       			<h2 class="am-text-center" style="font-size:2.5em;">不能为儿童单独购买机票，需要与成人一同购票。</h2>
            </div>
       	</div>
        <!--<div class="am-u-lg-8 ad_box_group">
            <h1>保险购买信息</h1>
            <div class="am-g">
			  <label class="am-u-sm-3">选择保险</label>
			  <label class="am-u-sm-9">
			  	<select class="am-u-lg-4" name="bx">
	            	<option value="0">不购买</option>
	            	<volist name='bxdata' id='vo'>
	            	<option value="{$vo.prodId}">{$vo.companyName}--{$vo.prodName}</option>
	            	</volist>
	            </select>
			  </label>
			</div>
			<input type="hidden" name="bxfaceprice" value="0"/>
			<div class="bxdetail" style="display: none;">
				<div class="am-g">
				  <label class="am-u-sm-3">保险公司</label>
				  <label class="am-u-sm-9" id="bxcompanyName"></label>
				</div>
				<div class="am-g">
				  <label class="am-u-sm-3">险种编号</label>
				  <label class="am-u-sm-9" id="bxtypecode"></label>
				</div>
				<div class="am-g">
				  <label class="am-u-sm-3">保险类型</label>
				  <label class="am-u-sm-9" id="bxinsuretype"></label>
				</div>
				<div class="am-g">
				  <label class="am-u-sm-3">售价(元)</label>
				  <label class="am-u-sm-9" id="bxnormalPrice">
				  </label>
				</div>
				<div class="am-g">
				  <label class="am-u-sm-3">保险天数</label>
				  <label class="am-u-sm-9" id="bxterm"></label>
				</div>
				<div class="am-g">
				  <label class="am-u-sm-3">购买数量限制</label>
				  <label class="am-u-sm-9" id="bxcountLimit"></label>
				</div>
				<div class="am-g">
				  <label class="am-u-sm-3">被保人年龄限制</label>
				  <label class="am-u-sm-9" id="bxinsuredAgeLimit">
				  </label>
				</div>
				<div class="am-g">
				  <label class="am-u-sm-3">投保人年龄限</label>
				  <label class="am-u-sm-9" id="bxunderWriteAgeLimit">
				  </label>
				</div>
				<div class="am-g">
				  <label class="am-u-sm-3">简述</label>
				  <label class="am-u-sm-9" id="bxdesp">
				  </label>
				</div>
				<div class="am-g">
				  <label class="am-u-sm-3">被保金额(元)</label>
				  <label class="am-u-sm-9" id="bxinsuranceAmount">
				  </label>
				</div>
				<div class="am-g">
				  <label class="am-u-sm-3">购买数量</label>
				  <label class="am-u-sm-9">
				  	1份
				  	<input name="bxnum" type="hidden" value="1" min="1" max="1" disabled="disabled"/>
				  </label>
				</div>
			</div>
        </div>-->
        <input name="bxnum" type="hidden" value="1"/>
        <input name="bxfaceprice" type="hidden" value="{$bxdata[0]['normalPrice']}"/>
        <input name="bx" type="hidden" value="{$bxdata[0]['prodId']}"/>
        <input name="isover18" type="hidden" value="" />
        <!--付款信息-->
        <div class="am-u-lg-8 am-u-end am-text-right">
            <p>订票人数：<span class="sumCustomer blod am-text-warning" style="font-size: 3.0rem;margin-bottom: 10px;">0</span>人 应付总额：<span class="sumpr blod am-text-warning">0</span>元</p>
            <button class="am-btn am-btn-lg am-btn-primary" type="button" id="addsubmit">提交订单</button>
        </div>
    </form>
    </div>
</div>


<div class="am-modal am-modal-alert" tabindex="-1" id="rule">
  <div class="am-modal-dialog">
    <div class="am-modal-hd">退改签政策</div>
    <div class="am-modal-bd" style="padding:10px 20px;text-align:left">
      <notempty name="fromRule">
      	<strong>去程政策：</strong><br/>
      	改期说明：{$fromRule.ticketChangeRemark}<br/>
      	退票说明：{$fromRule.ticketBounceRemark}<br/>
      	签转说明：{$fromRule.ticketSignChangeRemark}<br/><br/>
      </notempty>

      <notempty name="toRule">
      	<strong>返程政策：</strong><br/>
		改期说明：{$toRule.ticketChangeRemark}<br/>
      	退票说明：{$toRule.ticketBounceRemark}<br/>
      	签转说明：{$toRule.ticketSignChangeRemark}
      </notempty>
    </div>
    <div class="am-modal-footer">
      <span class="am-modal-btn">确定</span>
    </div>
  </div>
</div>

<!--<script type="text/javascript" src="/Public/hangtian/js/jquery-1.11.0.js"></script>-->
<script type="text/javascript" src="/Public/hangtian/plugin/dtp1/jquery.datetimepicker.full.min.js"></script>
<script>
/**
 * 选择保险
 */

var isover18 = 1;


//去尾法
Number.prototype.toFloor = function (num) {
return Math.floor(this * Math.pow(10, num)) / Math.pow(10, num);
};

$('select[name=bx]').on('change',function(){
	var pid=$(this).val();
	if(pid==0){
		$('.bxdetail').hide();
		return false;
	}
	$.ajax({
		type:"post",
		url:"{:U('getbxdetail')}",
		data:{pid:pid},
		async:true,
		success:function(e){
			if(e){
				$('#bxcompanyName').html(e.companyName);
				$('#bxtypecode').html(e.typeCode);
				$('#bxinsuretype').html(e.insureType=='ACCIDENT'?'航空意外险':'航空延误险');
				$('#bxnormalPrice').html(e.normalPrice);
				$('#bxterm').html(e.term);
//				$('#bxcountLimit').html('儿童票限购:'+e.countLimit.child+'张,成人票限购:'+e.countLimit.adult+'张');
				$('#bxinsuredAgeLimit').html(e.insuredAgeLimit.lowerLimit+'至'+e.insuredAgeLimit.upperLimit+'岁');
				$('#bxunderWriteAgeLimit').html(e.underWriteAgeLimit.lowerLimit+'至'+(e.underWriteAgeLimit.upperLimit==0?'~':e.underWriteAgeLimit.upperLimit)+'岁');
				$('#bxdesp').html('<a href="'+e.desp+'"target="_blank">点击查看</a>');
				$('#bxinsuranceAmount').html(e.insuranceAmount);
				$('input[name=bxfaceprice]').val(e.normalPrice);
				$('.bxdetail').show();
				$('input[name=bxnum]').change();
			}else{
				$('.bxdetail').hide();
			}
		}
	});
});
//计算总价
$('input[name=bxnum]').on('change',function(){
	var sump=parseFloat('{$sumprice}');
	var bnum=$(this).val();
	var bprice=parseFloat($('#bxnormalPrice').html());
	var sumprice=sump+bnum*bprice;
	$('.sumprice').html(sumprice);
});
$('.selbxgs').on('change',function(){
	alert($(this).find('option[select]').data('json'));
})
	if($('#addidd').val()){
		$("input[name='sender']").each(function () {
	        if ($(this).val() == $('#addidd').val()) {
	            $(this).attr("checked", "checked");
	        }
	    });
	}

    $.datetimepicker.setLocale('ch');
	//日期选择框初始化
    $("#ckbirthday").datetimepicker({
        timepicker: false,
        format: 'Y-m-d ',
        minDate: '1970/01/01'
    });
    $(function(){
    	$('#rule').modal();
        $('#addsubmit').on('click', function(){
        	if(isover18 == 0){
        		alert("不能为儿童单独购买机票，需要与成人一同购票。");
        		return false;
        	}
//          var lxr_name = $('input[name="lxr_name"]').val();
//          var lxr_phone = $('input[name="lxr_phone"]').val();
			var lxr = $('input:radio[name="sender1"]:checked').val();
//          var chengke = $('input[name="chengke"]').val();
//          var phone = $('input[name="phone"]').val();
//          var shengri = $('input[name="shengri"]').val();
//          var shenfenzheng = $('input[name="shenfenzheng"]').val();
			var ck = $('.choosecjr:checked').val();
//          if(!lxr_name.length){
//              alert('请填写联系人');
//              return;
//          }else if(!lxr_phone.length){
//              alert('请填写联系人手机号!');
//              return;
//          }else if(!chengke.length){
//              alert('请填写乘客姓名!');
//              return;
//          }else if(!phone.length){
//              alert('请填写乘客手机号!');
//              return;
//          }else if(!shengri.length){
//              alert('请填写乘客生日!');
//              return;
//          }else if(!shenfenzheng.length){
//              alert('请填写身份证号!');
//              return;
//          }else{
//              
//          }

			var toubaoren = $.trim($("#toubaoren").val());
			var toubaorenphone = $.trim($("#toubaorenphone").val());
			var toubaorenid = $.trim($("#toubaorenid").val());
			if(!lxr){
                alert('请先选择联系人信息，在进行选择！');
                return;
            }else if(!ck){
                alert('请先选择乘客信息，在进行选择!');
                return;
            }

            if(isover18 == 0){
            	if(!toubaoren.length){
            		alert("投保人姓名不能为空。");
            		return false;
            	}

            	if(!toubaorenphone.length){
            		alert("投保人手机号不能为空。");
            		return false;
            	}

            	if(toubaorenphone.length != 11){
            		alert("投保人手机号格式不正确，请检查。");
            		return false;
            	}

            	if(!toubaorenid.length){
            		alert("投保人身份证号不能为空。");
            		return false;
            	}

            	if(toubaorenid.length != 18){
            		alert("投保人身份证号格式不正确，请检查。");
            		return false;
            	}
            }
//          alert($('#formact').serialize());
//          return false;
			$("[name='isover18']").val(isover18);
            $('#formact').submit();
            $(this).prop("disabled", true);
        });

    });


    function jsGetAge(strBirthday)
	{     
		var returnAge;
		var strBirthdayArr=strBirthday.split("-");
		var birthYear = strBirthdayArr[0];
		var birthMonth = strBirthdayArr[1];
		var birthDay = strBirthdayArr[2];
		
		d = new Date();
		var nowYear = d.getFullYear();
		var nowMonth = d.getMonth() + 1;
		var nowDay = d.getDate();
		
		if(nowYear == birthYear)
		{
			returnAge = 0;//同年 则为0岁
		}
		else
		{
			var ageDiff = nowYear - birthYear ; //年之差
			if(ageDiff > 0)
			{
				if(nowMonth == birthMonth){
					var dayDiff = nowDay - birthDay;//日之差
					if(dayDiff < 0)
					{returnAge = ageDiff - 1;}
					else
					{returnAge = ageDiff ;}
				}else{
					var monthDiff = nowMonth - birthMonth;//月之差
					if(monthDiff < 0)
					{returnAge = ageDiff - 1;}
					else
					{returnAge = ageDiff ;}
				}
			}
			else
			{
				returnAge = -1;//返回-1 表示出生日期输入错误 晚于今天
			}
		}
		return returnAge;//返回周岁年龄
	}

	//取消
		function qxcjr() {
			$('#hasaddress').show();
			$('#formcjr1').hide();
			$('#ckname1').val('');
			$('#ckmobile1').val('');
			$('#ckbirthday1').val('');
			$('#ckid1').val('');
		}
		//取消2
		function qxcjr1() {
			$('#hasaddress').show();
			$('#formcjr').hide();
		}
		//保存
		function savecjr2() {							
		var id=$("#addid").val();
		var cjrname = $("#ckname1").val();
		var cjrmobile = $("#ckmobile1").val();
//		var cjrbirthday = $("#ckbirthday1").val();
		var cjrfm = $('#wrap input[name="fm1"]:checked').val();
		var cjrid = $("#ckid1").val();
		if(!cjrname){
			alert('请输入乘机人姓名！');
			return false;
		}
		if(!cjrmobile){
			alert('请输入乘机人电话！');
			return false;
		}
		if(cjrmobile.length != 11){
			alert("手机号格式错误，请确认。")
			return false;
		}
//		if(!cjrbirthday){
//			alert('请选择乘机人生日！');
//			return false;
//		}
		if(!cjrfm){
			alert('请选择乘机人性别！');
			return false;
		}
		if(!cjrid){
			alert('请输入乘机人身份证号！');
			return false;
		}
		if(cjrid.length != 18){
			alert("身份证号格式有误，请确认。");
			return false;
		}
//			alert(id);
		$.ajax({
			type: 'post', //传送的方式,get/post
			url:"{:U('Home/Jipiao/addsave')}",
			data: {
				id:id,
				cjrname: cjrname,
				cjrmobile: cjrmobile,
				cjrfm: cjrfm,
				cjrid: cjrid
			},
			dataType: "json",
			success: function (e) {
				if(e.status==1){
					alert(e.msg);
					// var tourl = "./index.php?s=/Home/Jipiao/addOrder/info/{:I('info')}/lxrname/"+$('#lxrname').val()+"/lxrmobile/"+$('#lxrmobile').val()+"/addid/"+e.id+".html";
					// tourl = encodeURI(tourl);
					// location.href = tourl;
					location.reload();
				}else{
					alert(e.msg);
				}
			},
			error: function (event, XMLHttpRequest, ajaxOptions, thrownError) {
				alert("表单错误，" + XMLHttpRequest + thrownError);
			}
		})
			
			
		}
		
		//check attendee old >= 18
		$(".choosecjr").click(function(){
			var choosecjrChecked = $(".choosecjr:checked");
			var hasAdult = false;

			var cjrid, birthday, age;

			for (var i = 0; i < choosecjrChecked.length; i++) {
				cjrid = choosecjrChecked.eq(i).data("cjrid");
				birthday = cjrid[6] + cjrid[7] + cjrid[8] + cjrid[9] + "-" + cjrid[10] + cjrid[11] + "-"  + cjrid[12] + cjrid[13];
				age = jsGetAge(birthday);
				console.debug(age);
				if(age >= 18){
					hasAdult = true;
					break;
				}	
			}

			if(hasAdult){
				isover18 = 1;
				$("#tbrxx").hide();
				$(".sumCustomer").html(choosecjrChecked.length);

				var sumPrice = parseFloat($(".tk_price span").html()) * choosecjrChecked.length;
				sumPrice = sumPrice.toFloor(1);
				$(".sumpr").html(sumPrice);
			}else{
				isover18 = 0;
				$("#tbrxx").show();
				$(".sumCustomer").html(0);
				$(".sumpr").html(0);
			}

			if(choosecjrChecked.length == 0){
				isover18 = 1;
				$("#tbrxx").hide();
				$(".sumCustomer").html(0);
				$(".sumpr").html(0);
			}
		})
		
		$(function(){
			var choosecjrChecked = $(".choosecjr:checked");
			$(".sumCustomer").html(choosecjrChecked.length);
			var sumPrice = parseFloat($(".tk_price span").html()) * choosecjrChecked.length;
			sumPrice = sumPrice.toFloor(1);
			$(".sumpr").html(sumPrice);
		})

		//新增
		$('#addcjr').on('click',function(){
			$('#hasaddress').hide();
			$('#formcjr').show();
			$('#ckname').val('');
			$('#ckmobile').val('');
			$('#ckbirthday').val('');
			$('#ckid').val('');
		});
		//修改
		$('#setcjr').on('click',function(){
			var val = $('.choosecjr:checked');
			if(val.length > 1){
				alert("如果要修改乘机人，请选择单独一位乘机人。");
				return false;
			}

			if(val.length == 0){
				alert("请选择一个乘机人!");
				return false;
			}

			$('#hasaddress').hide();
			$('#formcjr1').show();
//				alert(val);
			$.ajax({
				type:"post",
				url:"{:U('Home/Jipiao/addset')}",
				async:true,
				data:{
					'addid':val.val()
				},
				success:function(e){
					if(e.status==1){
						var add=e.add;
						$('#ckname1').val(add.cjrname);
						$('#ckmobile1').val(add.cjrmobile);
//						$('#ckbirthday1').val(add.cjrbirthday);
						$('#ckid1').val(add.cjrid);
						$("input[name='fm1']").each(function () {
				            if ($(this).val() == add.cjrfm) {
				                $(this).attr("checked", "checked");
				            }
				        });
						$('#addid').val(add.id);
					}else{
						alert(e.msg);
					}
				}
			});
							
		});
		function savecjr() {
		var cjrname = $("#ckname").val();
		var cjrmobile = $("#ckmobile").val();
//		var cjrbirthday = $("#ckbirthday").val();
		var cjrfm = $('#wrap input[name="fm2"]:checked').val();
		var cjrid = $("#ckid").val();
		if(!cjrname){
			alert('请输入乘机人姓名！');
			return false;
		}
		if(!cjrmobile){
			alert('请输入乘机人电话！');
			return false;
		}
//		if(!cjrbirthday){
//			alert('请选择乘机人生日！');
//			return false;
//		}
		if(!cjrfm){
			alert('请选择乘机人性别！');
			return false;
		}
		if(!cjrid){
			alert('请输入乘机人身份证号！');
			return false;
		}
		$.ajax({
			type: 'post', //传送的方式,get/post
			url: '{:U("Jipiao/address")}', //发送数据的地址
			data: {
				cjrname: cjrname,
				cjrmobile: cjrmobile,
				cjrfm: cjrfm,
				cjrid: cjrid,
				uid: $('#userid').val()
			},
			dataType: "json",
			success: function (e) {
				// var tourl = "./index.php?s=/Home/Jipiao/addOrder/info/{:I('info')}/lxrname/"+$('#lxrname').val()+"/lxrmobile/"+$('#lxrmobile').val()+"/addid/"+e.id+".html";
				// tourl = encodeURI(tourl);
				// location.href = tourl;
				location.reload();
			},
			error: function (event, XMLHttpRequest, ajaxOptions, thrownError) {
				alert("表单错误，" + XMLHttpRequest + thrownError);
			}
		})
	}
		
		function savecjr1() {
		var cjrname = $("#ckname").val();
		var cjrmobile = $("#ckmobile").val();
//		var cjrbirthday = $("#ckbirthday").val();
		var cjrfm = $('#wrap input[name="fm2"]:checked').val();
		var cjrid = $("#ckid").val();
		if(!cjrname){
			alert('请输入乘机人姓名！');
			return false;
		}
		if(!cjrmobile){
			alert('请输入乘机人电话！');
			return false;
		}
//		if(!cjrbirthday){
//			alert('请选择乘机人生日！');
//			return false;
//		}
		if(!cjrfm){
			alert('请选择乘机人性别！');
			return false;
		}
		if(!cjrid){
			alert('请输入乘机人身份证号！');
			return false;
		}
		$.ajax({
			type: 'post', //传送的方式,get/post
			url: '{:U("Jipiao/address")}', //发送数据的地址
			data: {
				cjrname: cjrname,
				cjrmobile: cjrmobile,
				cjrfm: cjrfm,
				cjrid: cjrid,
				uid: $('#userid').val()
			},
			dataType: "json",
			success: function (e) {
				// var tourl = "./index.php?s=/Home/Jipiao/addOrder/info/{:I('info')}/lxrname/"+$('#lxrname').val()+"/lxrmobile/"+$('#lxrmobile').val()+"/addid/"+e.id+".html";
				// tourl = encodeURI(tourl);
				// location.href = tourl;
				location.reload();
			},
			error: function (event, XMLHttpRequest, ajaxOptions, thrownError) {
				alert("表单错误，" + XMLHttpRequest + thrownError);
			}
		})
	}





    var sumrs = 1;
    var ckmodel = $("#ck_list").html();
    //添加乘客
    $(".add_ck_btn").on("click", function() {
        $("#ck_list").append(ckmodel);
        $(".bx_rs select").append('<option value="' + parseInt(sumrs + 1) + '">' + parseInt(sumrs + 1) + '人</option>');
        sumrs++;
        //删除乘客
        $(".del_ck").on("click", function() {
            if (sumrs > 1) {
                $(this).parent().remove();
                $(".bx_rs select option:last-child").remove();
                sumrs--;
            }
        });
    });

    function DelCK(h) {
        console.log(h);
        if (sumrs > 1) {
            h.parent().remove();
            $(".bx_rs select option:last-child").remove();
            sumrs--;
        } else {
        }
    }
    var hbTop = $(".hb_info_gp").offset().top; //定位y
    var hbLeft = $(".hb_info_gp").offset().left; //定位x
    var hbWidth = $(".hb_info_gp").css("width");
    window.onscroll = function(e) {
        var e = e || window.event;
        var scrolltop = document.documentElement.scrollTop || document.body.scrollTop;
        if (scrolltop >= hbTop) {
            $(".hb_info_gp").css("position", "fixed").css("top", '10px').css("left", hbLeft + 'px').css('width', hbWidth);
        } else {
            $(".hb_info_gp").css("position", "absolute").css("top", '').css("left", '');
        }
    }
    $("#bxck").on("click", function() {
        $(".fp_input_box").toggle();
    });
	//取消
	function quxiao() {
		$('#hasaddress1').show();
		$('#formsender1').hide();
		$('#realname1').val('');
		$('#phone1').val('');
	}
	
	//保存
	function save() {							
		var id=$("#addidid").val();
		var realname = $("#realname1").val();
		var cellphone = $("#phone1").val();
		if(!realname){
			alert('联系人不能为空！')
			return false;
		}
		if(!cellphone){
			alert('手机号不能为空！')
			return false;
		}
		if(cellphone.length != 11){
			alert("手机号格式错误，请确认。");
			return false;
		}
//			alert(id);
		$.ajax({
			type: 'post', //传送的方式,get/post
			url:"{:U('Home/Jipiao/addsave1')}",
			data: {
				id:id,
				realname: realname,				
				cellphone: cellphone
			},
			dataType: "json",
			success: function (e) {
				if(e.status==1){
					alert(e.msg);
					location.reload();
				}else{
					alert(e.msg);
				}
			},
			error: function (event, XMLHttpRequest, ajaxOptions, thrownError) {
				alert("表单错误，" + XMLHttpRequest + thrownError);
			}
		})
	}
	
	//新增
	$('#addaddress').on('click',function(){
		$('#hasaddress1').hide();
		$('#formsender').show();
		$('#realname').val('');
		$('#phone').val('');
	});
	//修改
	$('#setaddress').on('click',function(){
		var val = $('input:radio[name="sender1"]:checked').val();
		//判断新地址是否选中,获取地址id
		if (val == null) {
			alert("请选择一个联系人!");
			return false;
		}
		$('#hasaddress1').hide();
		$('#formsender1').show();
//				alert(val);
		$.ajax({
			type:"post",
			url:"{:U('Home/Jipiao/addset1')}",
			async:true,
			data:{
				'addid':val
			},
			success:function(e){
				if(e.status==1){
					var add=e.add;
					$('#realname1').val(add.realname);
					$('#phone1').val(add.cellphone);
					$('#addidid').val(add.id);
				}else{
					alert(e.msg);
				}
			}
		});
						
	});

	function savemsg() {
		var info = "no";
		var pca = $("#idprovince").val() + $("#idcity").val() + $("#idarea").val();
		var address = $("#address").val();
		var orderid = $("#orderid").val();
		var username = $("#realname").val();
		var phone = $("#phone").val();
		var b = $("#youbian").val();

		$.ajax({
			type: 'post', //传送的方式,get/post
			url: '{:U("Address/build")}', //发送数据的地址
			data: {
				province: $("#idprovince").val(),
				city: $("#idcity").val(),
				area: $("#idarea").val(),
				posi: address,
				pho: phone,
				rel: username,
				id: orderid,
				msg: info
			},
			dataType: "json",
			success: function (data) {
				location.reload();
			},
			error: function (event, XMLHttpRequest, ajaxOptions, thrownError) {
				alert("表单错误，" + XMLHttpRequest + thrownError);
			}
		})
	}
		
	function savemsg1() {
		var info = "no";
		var pca = $("#idprovince").val() + $("#idcity").val() + $("#idarea").val();
		var address = $("#address").val();
		var orderid = $("#orderid").val();
		var username = $.trim($("#realname").val());
		var phone = $.trim($("#phone").val());
		var b = $("#youbian").val();


		if(username == ""){
			alert("请输入联系人姓名。");
			return false;
		}

		if(phone == ""){
			alert("请输入联系人的手机号。");
			return false;
		}

		if(phone.length != 11){
			alert("请输入正确的联系人手机号。");
			return false;
		}

		$.ajax({
			type: 'post', //传送的方式,get/post
			url: '{:U("Address/build")}', //发送数据的地址
			data: {
				province: $("#idprovince").val(),
				city: $("#idcity").val(),
				area: $("#idarea").val(),
				posi: address,
				pho: phone,
				rel: username,
				id: orderid,
				msg: info
			},
			dataType: "json",
			success: function (data) {
				location.reload();
			},
			error: function (event, XMLHttpRequest, ajaxOptions, thrownError) {
				alert("表单错误，" + XMLHttpRequest + thrownError);
			}
		})
	}
</script>
</block> 